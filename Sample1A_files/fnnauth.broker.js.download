/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.auth:models/fnnauth.broker",["require","jquery","cdn"],function(require,$,CDN){var iframe,root=window,env=CDN.env,domain="qa"===env?"//dev.static.foxnews.com":"//www.foxnews.com",ready=!1,callbacks={},ssl=["htt","ps:"].join(""),origin=ssl+domain,queue=[],iframeLink=origin+"/community/auth/user/iframe.html?",addCallback=function(name,cb){callbacks[name]=callbacks[name]||[],callbacks[name].push(cb)},sendMessage=function(name,data){var message={name:name,data:data,type:"fnnBrokerRequest"};ready?iframe.contentWindow.postMessage(message,origin):queue.push(message)},dispatch=function(event){if(event.origin===origin&&"fnnBrokerResponse"===event.data.type)if("ready"===event.data.name)for(ready=!0;queue.length>0;)iframe.contentWindow.postMessage(queue.shift(),origin);else{var cbs=callbacks[event.data.name]||[];for(callbacks[event.data.name]=[];cbs.length>0;)cbs.shift()(event.data.data)}},startLogin=function(){addCallback("startLogin",function(url){window.location.href=url}),sendMessage("startLogin",window.location.href)},startLogout=function(callback){callback&&addCallback("startLogout",callback),sendMessage("startLogout",null)},initialize=function(callback){callback({startLogin:startLogin,startLogout:startLogout})},FNNAuth=function(domainName){var refreshProfile=-1!==window.location.search.indexOf("refresh_profile_info=on");iframe=document.createElement("iframe"),iframe.style.display="none",iframe.src=iframeLink+(refreshProfile?"refresh_profile_info=on&":"")+"origin="+encodeURIComponent(root.location.origin)+"&domain="+encodeURIComponent(domainName),document.body.appendChild(iframe),root.addEventListener("message",dispatch)};return FNNAuth.prototype.initialize=initialize,FNNAuth.prototype.MODE_silentLogin=function(callback){addCallback("silentLogin",callback),sendMessage("silentLogin",null)},FNNAuth});