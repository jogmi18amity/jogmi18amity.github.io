/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.video:models/autoadvance",["require","jquery","lodash","helper","config"],function(require,$,_,Helper,config){function loadPlaylist(url,callback){REQUEST_STACK[url]?REQUEST_STACK[url].done?callback(REQUEST_STACK[url].data):REQUEST_STACK[url].fn.push(callback):(REQUEST_STACK[url]={data:null,fn:[callback],done:!1},$.ajax({url:url,dataType:"jsonp",jsonpCallback:"fxtartlist",cache:!0,success:function(data){var items=processData(data);REQUEST_STACK[url].data=items,REQUEST_STACK[url].done=!0,triggerStack(url)}}))}function triggerStack(url){if(REQUEST_STACK[url])for(var data=REQUEST_STACK[url].data;REQUEST_STACK[url].fn.length>0;){var fn=REQUEST_STACK[url].fn.shift();fn(data)}}function processData(data){var arr=[];if(data&&data.response&&data.response.docs)for(var items=data.response.docs,i=0;i<items.length;i++){var item=items[i],url=!!(item.url&&Array.isArray(item.url)&&item.url[0])&&item.url[0];if(url){var videoId=function(){var ret=null,sp=url.split("/v/")[1]||!1,v=!!sp&&sp.split("/")[0];return v&&!isNaN(v)&&(ret=v),ret}();videoId&&arr.push(videoId)}}return arr}var REQUEST_STACK={};return function(Instance){var opts=Instance.getOpts();if(!!(opts&&opts.player&&opts.player.autoadvance&&opts.player.autoadvance.enabled)&&(!opts.app.autoadvance||!(!opts.app.autoadvance||"custom"===opts.app.autoadvance))){var url=config.autoadvance.feed.replace("${domain}",["www",opts&&opts.player&&/foxbusiness/i.test(opts.player.domain)?"foxbusiness":"foxnews","com"].join(".")),index=0;loadPlaylist(url,function(items){Instance.on("amp.advance",function(){var nextVideoId=items[index]||null;Helper.log("playing next video id:",nextVideoId),nextVideoId&&(Instance.change(nextVideoId,{player:{autoplay:!0}}),index++)})})}}});