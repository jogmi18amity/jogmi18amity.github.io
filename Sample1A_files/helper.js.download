/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.video:helper",["require","jquery","akamai.time","config","core.base:utils/script.loader","core.plugins:URLInfo","jquery.cookie"],function(require,$,time,config){var loadScript=require("core.base:utils/script.loader"),URLInfo=require("core.plugins:URLInfo"),cdn=config.cdn,Helper=function(){};return Helper.prototype.getCurrentTime=function(){return time.getCurrent()},Helper.prototype.getEnv=function(){return cdn.env},Helper.prototype.getDomainId=function(){var hostname=window.location.hostname;return/foxbusiness\.com/.test(hostname)?"foxbusiness":/insider\.foxnews\.com/.test(hostname)?"insider.foxnews":"foxnews"},Helper.prototype.validateVideoId=function(id){return!/[^0-9]/g.test(id)},Helper.prototype.setEventName=function(name){return[config.eventPrefix,name].join("_")},Helper.prototype.loadScript=function(src,callback){if(src="string"==typeof src?[src]:src,$.isArray(src)){var trigger=function(){src.length>0?loadScript(src.shift(),function(){trigger()}):"function"==typeof callback&&callback()};trigger()}},Helper.prototype.enc=function(val){return encodeURIComponent(val)},Helper.prototype.dec=function(val){return decodeURIComponent(val)},Helper.prototype.log=function(){if(window.console){var args=Array.prototype.slice.call(arguments);args.unshift("[core.video]");try{return window.console.log.apply(window.console,args)}catch(err){window.console.log(args.join(" | "))}}},Helper.prototype.getQueryVar=function(name){var url=new URLInfo(window.location.href).getInfo(),res=url.query[name]||url.hash[name]||null;return null!==res&&"boolean"==typeof res&&(res=res.toString()),res},Helper.prototype.setUrlQuery=function(url,props){var item=new URLInfo(url),info=item.getInfo();for(var id in props){var val=props[id];info.query[id]?info.query[id]=val:info.hash[id]=val}return info},Helper.prototype.reEmbedIframe=function(instance,newOpts){var self=this,res=!1,currVideoId=instance._opts.app.videoId,currDomain=instance._opts.app.domain,isLegacy=instance._opts.app.legacy||!1,isTVE=self.isTVEVideoId(currVideoId),newIsTVE=self.isTVEVideoId(newOpts.app.videoId),newDomain=newOpts.app.domain||"foxnews";return isLegacy?res=!0:currVideoId!==config.fncRadioId&&newOpts.app.videoId===config.fncRadioId?res=!0:currVideoId===config.fncRadioId&&newOpts.app.videoId!==config.fncRadioId?res=!0:currDomain!==newDomain?res=!0:isTVE&&!newIsTVE||!isTVE&&newIsTVE?res=!0:isTVE&&newIsTVE&&currVideoId!==newOpts.app.videoId&&(res=!0),res},Helper.prototype.generateBundlePaths=function(ver,env,opts){var self=this,isTVE=opts.app.tve||!1,envFolder=(opts.app.auth,"prod"===env&&"qa"===config.cdn.env?"player":"qa"===config.cdn.env?"player/test":"player"),path=config.akamai.bundlePattern.replace("${version}",ver).replace("${envFolder}",envFolder),res={path:path,script:path+"/amp.premier"+("qa"===config.cdn.env?"":".min")+".js",conf:path+"/amp.foxnews.central.json?sec="+(config.akamai.secure?"1":"0")},queryParams=[];return function(){var site;if(isTVE){var domainId=(opts.app.videoId,config.tve.foxbusiness.videoId,opts.app.videoId===config.tve.foxbusiness.videoId?"live.foxbusiness":"foxnews");site=config.akamai.configParam.site[domainId]}else site=opts.app.ampConfig&&opts.app.ampConfig.site?opts.app.ampConfig.site:config.videoDomain.indexOf(opts.app.domain)>-1?config.akamai.configParam.site[opts.app.domain]:config.akamai.configParam.site[self.getDomainId()];queryParams.push("site="+site)}(),function(){var params="notitle";opts.app.ampConfig&&"string"==typeof opts.app.ampConfig.params&&(params=[params,opts.app.ampConfig.params].join(",")),params=_.uniq(params.split(",")).join(","),queryParams.push("param="+params)}(),function(){opts.app.ampConfig&&opts.app.ampConfig.namespace&&queryParams.push("ns="+opts.app.ampConfig.namespace)}(),queryParams.length>0&&(res.conf=res.conf+"&"+queryParams.join("&")),res},Helper.prototype.cacheBuster=function(interval){isNaN(interval)?(interval=Math.floor(parseInt(interval,10)),interval=interval<2?2:interval>59?60:interval):interval=2;var c=this.getCurrentTime(),mins=c.getMinutes(),ret=[c.getFullYear(),c.getMonth()+1,c.getDate(),c.getHours()].join("");return ret+=Math.floor(mins/interval)},Helper.prototype.setResponseTarget=function(resourceID,prefix){prefix=prefix||"live";var redirect="FoxBusiness"===resourceID?"_fb":"_fn";redirect=prefix+redirect;var popup="FoxBusiness"===resourceID?"_fb_winpopup":"_fn_winpopup";return popup=prefix+popup,{redirect:redirect,popup:popup}},Helper.prototype.isTVEVideoId=function(id){var res=!1;for(var i in config.tve)if(config.tve[i].videoId===id){res=!0;break}return res},Helper.prototype.setAISCookie=function(opts){var val=opts&&opts.player&&opts.player.ais&&"string"==typeof opts.player.ais.redir?opts.player.ais.redir:null,expires=val?1:-1,cookieDomain=function(){var sp=window.location.hostname.split(".");return"."+sp.slice(sp.length-2).join(".")}();$.cookie("FXN_v_idpp",val,{path:"/",domain:cookieDomain,expires:expires})},Helper.prototype.getHeight=function(width){return 9*Math.round(width/16)},Helper.prototype.getArticleBody=function(){var el=$("article div[itemprop='articleBody']");return 0===el.length&&(el=$("article .article-body")),el},Helper.prototype.getVideoFeedUrl=function(videoId,conf){return"//"+function(domain){var res="video.foxnews.com";return domain&&/foxbusiness/i.test(domain)&&(res="video.foxbusiness.com"),"prod"!==cdn.env&&(res="beta."+res),res}(conf&&conf.domain?conf.domain:null)+"/v/feed/video/"+videoId+".json?template=fox"},Helper.prototype.getPlaylistFeedUrl=function(playlistId,conf){return"//"+function(domain){var res="video.foxnews.com";return domain&&/foxbusiness/i.test(domain)&&(res="video.foxbusiness.com"),"prod"!==cdn.env&&(res="beta."+res),res}(conf&&conf.domain?conf.domain:null)+"/v/feed/playlist/"+playlistId+".json?template=fox"},new Helper});