/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.video:api",["require","jquery","lodash","helper","@fnc/embed/main","models/embeds","models/autoadvance","models/get.video","models/ais.auth","akamai.ver"],function(require,$,_,Helper){var VideoEmbed=require("@fnc/embed/main"),PageEmbeds=require("models/embeds"),AutoAdvance=require("models/autoadvance"),GetVideoFeed=require("models/get.video"),AISAuth=require("models/ais.auth"),AKAMAI_VERSION=require("akamai.ver"),PLAYLIST_STACK={},App=function(){};return App.prototype.embed=function(target,opts){if(0===target.length)return Helper.log("Error: called video embed, no target!"),null;if(1!==target.length)return Helper.log("Error: multiple targets, loop through each one"),null;opts=_.isObject(opts)?_.cloneDeep(opts):{};var Instance=new VideoEmbed(target,opts);return Instance.set(),AutoAdvance(Instance),Instance},App.prototype.provider=function(type,target,opts,callback){require(["views/"+type+"/main"],function(App){new App(target,opts).set(callback)})},App.prototype.__iframe=function(type,opts,callback){require(["@fnc/iframe/main"],function(App){new App(type,opts).set(callback)})},App.prototype.getInfo=function(){return{build:"v"+AKAMAI_VERSION,embeds:PageEmbeds.getInfo()}},App.prototype.getQueryVar=function(val){return Helper.getQueryVar(val)},App.prototype.getVideoFeedById=function(){GetVideoFeed.apply(GetVideoFeed,arguments)},App.prototype.getPlaylistFeed=function(playlistId){function normalize(data){var obj={};obj.raw=data;var channel=data.channel,item=channel.item;return item=Array.isArray(item)?item:[item],obj.items=item,obj}var args=arguments,domain=null,callback=null;if("object"==typeof args[1]?(domain=args[1].domain||null,args[2]&&"function"==typeof args[2]&&(callback=args[2])):"function"==typeof args[1]&&(callback=args[1]),!(!playlistId||!callback)){if(PLAYLIST_STACK[playlistId])return void callback(PLAYLIST_STACK[playlistId]);var url=Helper.getPlaylistFeedUrl(playlistId,{domain:domain||null});$.ajax({url:url,dataType:"jsonp",jsonpCallback:"uid_"+playlistId}).done(function(data){var norm=normalize(data);PLAYLIST_STACK[playlistId]=norm,callback(norm)})}},App.prototype.translateConfig=function(legacy,conds){var config=_.cloneDeep(legacy);conds=conds||{};var res={};return res.app={videoId:config.app.videoId,domain:config.app.domain,rules:function(){var arr=[];return config.player.autoplay&&!conds.playNext&&arr.push("autoplay"),config.player.autoadvance&&config.player.autoadvance.enabled&&arr.push("autoAdvance"),config.player.params&&config.player.params.playerName&&arr.push("playername:"+config.player.params.playerName),arr}()},res.player=config.player,res},App.prototype.isAISAuthenticated=function(callback){"function"==typeof callback&&AISAuth.init(callback)},new App});