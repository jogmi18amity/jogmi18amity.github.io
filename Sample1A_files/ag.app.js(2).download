/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.templates:api",["require","controls/api"],function(require){return require("controls/api")});
Modulr.define("core.templates:config",["cdn","core.base:utils/environment"],function(cdn,Env){var config={};config._clone=function(){return{iframe:cdn.domain+"/static/orion/scripts/core/templates/app/iframe.html?v="+Env.getCacheParam(),readyEvent:"FOX_TPL_FRAME.ready",handlerEvent:"FOX_TPL_FRAME.handler",templateEvent:"FOX_TPL_HANDLER",frameId:"frame-template"}};var cloned=config._clone();for(var id in cloned)config[id]=cloned[id];return config});
Modulr.define("core.templates:controls/api",["require","jquery","lodash","config","core.plugins:EventMessageHandler","core.plugins:URLInfo"],function(require,$,_,config){var EventHandler=require("core.plugins:EventMessageHandler"),URLInfo=require("core.plugins:URLInfo"),CONFIG=config._clone();return new function(config){function setPath(template){var url=[basePath,template].join("/").replace(/\/+/i,"/"),dataset=new URLInfo(url),query=dataset.getInfo().query;if(!query||!query.cb){var cb=function(){var c=new Date,secs=c.getSeconds(),ret=[c.getFullYear(),c.getMonth()+1,c.getDate(),c.getHours(),c.getMinutes()].join("");return ret+=secs<=30?"30":"01"}();dataset.addQuery({cb:cb}),url=dataset.getUrl()}return url}function sendMessage(info){var iframeDom=$("#"+CONFIG.frameId).get(0);Events.sendMessage(iframeDom,CONFIG.handlerEvent,{uid:info.uid,template:info.template})}function embedFrame(){$(document).ready(function(){if(0===$("#"+CONFIG.frameId).length){var iframe='<iframe id="'+CONFIG.frameId+'" src="'+FRAME_SRC+'" style="display: none; opacity: 0; width: 0px; height: 0px;"></iframe>';$("body").append(iframe),0===$("body #"+CONFIG.frameId).length&&setTimeout(function(){embedFrame()},150)}})}function getTemplateUid(template){var sp=template.split("/"),name=sp[sp.length-1];name=name.split("."),name=name.slice(0,name.length-1).join(".");var uid=[CONFIG.templateEvent,name].join("."),cntr=0;if(uidExists(uid)){for(;uidExists([uid,cntr].join("-"));)cntr++;uid=[uid,cntr].join("-")}return uid}function uidExists(uid){return!!TEMPLATES[uid]}config=config||{};var Proto=this,basePath=config.basePath||"",Events=new EventHandler,READY=!1,READY_STACK=[],TEMPLATES={},FRAME_INITIALIZED=!1,FRAME_SRC=config.iframeSrc||CONFIG.iframe;Events.addHandler(CONFIG.readyEvent,function(){if(READY_STACK.length>0)for(;READY_STACK.length>0;){var uid=READY_STACK.shift(),info=TEMPLATES[uid];sendMessage(info)}READY=!0}),Events.addHandler(CONFIG.handlerEvent,function(info){if(info.uid&&info.str){var uid=info.uid;for(TEMPLATES[uid].str=info.str;TEMPLATES[uid].stack.length>0;){var stack=TEMPLATES[uid].stack.shift();"function"==typeof stack&&stack(info.str)}}}),Proto.setFrameSource=function(src){"string"==typeof src&&(FRAME_SRC=src)},Proto.get=function(template,callback){FRAME_INITIALIZED||(FRAME_INITIALIZED=!0,embedFrame());var tpl=setPath(template),uid=getTemplateUid(template);TEMPLATES[uid]||(TEMPLATES[uid]={template:tpl,uid:uid,stack:[]}),READY?TEMPLATES[uid].executed?TEMPLATES[uid].str?callback(TEMPLATES[uid].str):TEMPLATES[uid].stack.push(callback):(TEMPLATES[uid].executed=!0,TEMPLATES[uid].stack.push(callback),sendMessage(TEMPLATES[uid])):(TEMPLATES[uid].stack.push(callback),READY_STACK.push(uid))}}});
Modulr.define("core.templates:controls/frame",["require","jquery","lodash","config","core.plugins:EventMessageHandler"],function(require,$,_,config){function loadTemplate(data,callback){$.ajax({url:data.template,dataType:"text"}).done(function(str){callback(str)})}var CONFIG=config._clone(),Events=new(require("core.plugins:EventMessageHandler"));Events.addHandler(CONFIG.handlerEvent,function(data){data.template&&data.uid&&loadTemplate(data,function(str){Events.sendMessage("parent",CONFIG.handlerEvent,{uid:data.uid,str:str})})}),Events.sendMessage("parent",CONFIG.readyEvent,!0)});
Modulr.define("core.templates:main",["require"],function(require){window._tpl_frame&&require(["controls/frame"])});
!function(Modulr,FNC){var uid="core.templates";if(Modulr.getInstance(uid))return!1;var Instance=Modulr.config({instance:uid,baseDomain:FNC.CDN.domain,baseUrl:"/static/orion/scripts/core/templates/app",masterFile:"/static/orion/scripts/core/utils/modulr/master.js",packages:["core.plugins","core.base"],shim:{jquery:{src:"/static/orion/scripts/core/utils/jquery/core.js",exports:"jQuery"},lodash:{src:"/static/orion/scripts/core/utils/lodash.js",exports:"_"}}});Instance.define("cdn",function(){return FNC.CDN}),Instance.require(["main"])}(window.Modulr,window.FNC);