/*! updated; 04-10-2018 03:45 PM **/


Modulr.define("core.plugins:OutbrainWidgetConnector",["jquery"],function($){var CONST={OBVar:"OB_elements",src:window.location.protocol+"//widgets.outbrain.com/outbrain.js",legacySrc:window.location.protocol+"//widgets.outbrain.com/outbrainWidget.js",langJS:window.location.protocol+"//widgets.outbrain.com/lang_en.js"},App=function(config){if(!config)return!1;this.addWidget(config)};App.prototype.addWidget=function(config,callback){var x;if(!config)return!1;window[CONST.OBVar]||(window[CONST.OBVar]=[]);var conf=setConfig(config);for(x=0;x<conf.length;x++){var cf=conf[x],modify=!cf.addWidgetType||"data-widget"!==cf.addWidgetType,containerEl=$("#"+cf.containerId);0===containerEl.length&&(containerEl=$('.OUTBRAIN[data-widget-id="'+cf.widgetId+'"]')),containerEl.is(":visible")?(cf.langJS=cf.langJS||CONST.langJS,cf.permalink=setPermaLink(cf.permalink),containerEl.attr("data-src",cf.permalink),modify&&(modifyContainer(containerEl),window[CONST.OBVar].push(cf)),cf.overlayDim&&setOverlay(cf.widgetId,cf.overlayDim)):containerEl.remove()}triggerScript(callback)},App.prototype.refreshWidgets=function(permaLink){if(!window.OBR)return!1;permaLink=permaLink||null;try{window.OBR.extern.refreshWidget(permaLink)}catch(err){}},App.prototype.addWidgetLegacy=function(config,callback){config=isArray(config)?config[0]:config,config.containerId&&modifyContainer($("#"+config.containerId)),config.permalink=setPermaLink(config.permalink),window.OB_permalink=config.permalink,window.OB_widgetId=config.widgetId,window.OB_Template=config.Template,window.OB_langJS=config.langJS||CONST.langJS,window.OB_isLateStarter=!0,triggerScript(callback,!0),config.overlayDim&&setOverlay(config.widgetId,config.overlayDim)};var triggerScript=function(callback,legacy){if(callback="function"==typeof callback?callback:function(){},window.OB_Script&&window.OutbrainStart)try{window.OutbrainStart(),callback()}catch(err){log("[Outbrain.Connector] Error: "+err)}else{var s=document.getElementsByTagName("script")[0],ob=document.createElement("script");ob.type="text/javascript",ob.onreadystatechange=ob.onload=function(){window.OB_Script=!0,callback()},ob.async=!0,ob.src=legacy?CONST.legacySrc:CONST.src,s.parentNode.insertBefore(ob,s)}},setOverlay=function(id,dim){dim=dim||"32";var overlayMarkup='<div class="media-overlay" style="position: absolute; bottom: 8px; width: '+dim+"px; min-height: "+dim+"px; background: url('//global.fncstatic.com/static/v/all/img/vd-overlay_"+dim+".png') no-repeat scroll 0px 0px transparent; right: 8px;\"></div>",check=function(){return $("div[data-widget-id='"+id+"'] .ob-rec-link-img").length>0},trigger=function(){setTimeout(function(){$("div[data-widget-id='"+id+"'] .ob-rec-link-img").each(function(){var el=$(this);if(el.find(".ob_video").length>0){el.prepend(overlayMarkup);var overlay=el.find("> .media-overlay");el.hover(function(){overlay.css("background-position","0px -"+dim+"px")},function(){overlay.css("background-position","0px 0px")})}})},100)};if($.loadAttempt)$.loadAttempt(25,250,function(){return check()},function(){trigger()});else{var timeoutObj=!1,cntr=0,timeoutFn=function(){check()?trigger():cntr<=25&&(cntr++,timeoutObj=setTimeout(function(){timeoutFn()},250))};timeoutFn()}},modifyContainer=function(container){container.addClass("OBR"),container.attr("data-fbk")||container.attr("data-fbk","1")},setConfig=function(info){return info&&!isArray(info)&&(info=[info]),info},setPermaLink=function(permalink){var loc=window.location;loc.host||loc.hostname;return permalink},isArray=function(val){return val=val||!1,"[object Array]"===Object.prototype.toString.call(val)};return App});